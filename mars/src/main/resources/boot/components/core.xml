<?xml version =	'1.0' encoding = 'ISO-8859-1'?>
<config>
	<boot locales="fr_FR">
		<plugin class="io.vertigo.core.plugins.resource.classpath.ClassPathResourceResolverPlugin" />
		<plugin class="io.vertigo.vega.plugins.webservice.servlet.WebAppContextParamPlugin"/>
		<plugin class="io.vertigo.core.plugins.param.xml.XmlParamPlugin">
			<param name="url" value="/boot/config/application-config.xml"/>
		</plugin>
	</boot>

	<module name="vertigo-commons">
		<component api="DaemonManager" class="io.vertigo.commons.impl.daemon.DaemonManagerImpl"/>
		<component api="AnalyticsManager" class="io.vertigo.commons.impl.analytics.AnalyticsManagerImpl" />
		<component api="ScriptManager" class="io.vertigo.commons.impl.script.ScriptManagerImpl">
			<plugin class="io.vertigo.commons.plugins.script.janino.JaninoExpressionEvaluatorPlugin" />
		</component>
		<component api="CodecManager" class="io.vertigo.commons.impl.codec.CodecManagerImpl" />
		<component api="CacheManager" class="io.vertigo.commons.impl.cache.CacheManagerImpl">
			<plugin class="io.vertigo.commons.plugins.cache.memory.MemoryCachePlugin" />
		</component>
	</module>
	
	<module name="vertigo-database">
		<component api="SqlDataBaseManager" class="io.vertigo.database.impl.sql.SqlDataBaseManagerImpl">
			<plugin class="io.vertigo.database.plugins.sql.connection.datasource.DataSourceConnectionProviderPlugin">
				<param name="classname" value="io.vertigo.database.impl.sql.vendor.h2.H2DataBase" />
				<param name="source" value="java:/comp/env/jdbc/DataSource" />
			</plugin>
		</component>
	</module>

	<module name="vertigo-dynamo">
		<component api="FileManager" class="io.vertigo.dynamo.impl.file.FileManagerImpl" />
		<component api="VTransactionManager" class="io.vertigo.commons.impl.transaction.VTransactionManagerImpl" />
		<component api="CollectionsManager" class="io.vertigo.dynamo.impl.collections.CollectionsManagerImpl" >
			<plugin class="io.vertigo.dynamo.plugins.collections.lucene.LuceneIndexPlugin" />
		</component>
		<component api="TaskManager" class="io.vertigo.dynamo.impl.task.TaskManagerImpl"/>
		<component api="EventBusManager" class="io.vertigo.commons.impl.eventbus.EventBusManagerImpl" />

		<component api="StoreManager" class="io.vertigo.dynamo.impl.store.StoreManagerImpl">
			<plugin class="io.vertigo.dynamo.plugins.store.datastore.sql.SqlDataStorePlugin">
				<param name="sequencePrefix" value="SEQ_" />
			</plugin>
			<plugin class="io.vertigo.dynamo.plugins.store.datastore.sql.SqlDataStorePlugin">
				<param name="dataSpace" value="orchestra"/>
				<param name="sequencePrefix" value="SEQ_" />
			</plugin>
			<plugin class="io.vertigo.dynamo.plugins.store.filestore.fs.FsFileStorePlugin">
				<param name="storeDtName" value="DT_MEDIA_FILE_INFO" />
				<param name="path" value="${user.home}/marsFiles/" />
			</plugin>
			<plugin class="io.vertigo.dynamo.plugins.store.filestore.fs.FsFullFileStorePlugin">
				<param name="name" value="temp"/>
				<param name="path" value="${java.io.tmpdir}/marsFiles/"/>
				<param name="purgeDelayMinutes" value="30" /> <!--  30min -->
			</plugin>
		</component>
		<component api="KVStoreManager" class="io.vertigo.dynamo.impl.kvstore.KVStoreManagerImpl">
			<plugin class="io.vertigo.dynamo.plugins.kvstore.delayedmemory.DelayedMemoryKVStorePlugin">
				<param name="collections" value="protected-value" />
				<param name="timeToLiveSeconds" value="3600" /><!-- 1h -->
			</plugin>
			<plugin class="io.vertigo.dynamo.plugins.kvstore.berkeley.BerkeleyKVStorePlugin">
				<param name="collections" value="VViewContext;TTL=43200" /> <!-- 12h -->
				<param name="dbFilePath" value="${java.io.tmpdir}/vertigo/TestVViewContext" />
			</plugin>
		</component>
	</module>
	
	<module name="vertigo-search">
		<component api="SearchManager" class="io.vertigo.dynamo.impl.search.SearchManagerImpl">
		    <plugin class="io.vertigo.dynamo.plugins.search.elasticsearch.embedded.ESEmbeddedSearchServicesPlugin">
		        <param name="home" value="search/" />
		        <param name="envIndex" value="MARS" />
		        <param name="rowsPerQuery" value="50" />
		        <param name="config.file" value="search/elasticsearch.yml" />
		    </plugin>
		</component>
	</module>
	
	<module name="vertigo-persona">
		<component api="VSecurityManager" class="io.vertigo.persona.impl.security.VSecurityManagerImpl">
			<param name="userSessionClassName" value="io.mars.commons.MarsUserSession" />
		</component>
	</module>
	 
	<module name="vertigo-vega" >
		<component api="WebServiceManager" class="io.vertigo.vega.impl.webservice.WebServiceManagerImpl">
			<plugin class="io.vertigo.vega.plugins.webservice.scanner.annotations.AnnotationsWebServiceScannerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.webserver.sparkjava.SparkJavaServletFilterWebServerPlugin" >
				<param name="apiPrefix" value="/api"/>
			</plugin>
			<!-- Handlers -->
			<plugin class="io.vertigo.vega.plugins.webservice.handler.ExceptionWebServiceHandlerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.handler.SessionInvalidateWebServiceHandlerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.handler.SessionWebServiceHandlerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.handler.RateLimitingWebServiceHandlerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.handler.SecurityWebServiceHandlerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.handler.AccessTokenWebServiceHandlerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.handler.JsonConverterWebServiceHandlerPlugin"/>
			<plugin class="io.vertigo.vega.plugins.webservice.handler.PaginatorAndSortWebServiceHandlerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.handler.ValidatorWebServiceHandlerPlugin" />
			<plugin class="io.vertigo.vega.plugins.webservice.handler.RestfulServiceWebServiceHandlerPlugin" />
		</component>
		<component api="JsonEngine" class="io.vertigo.vega.engines.webservice.json.GoogleJsonEngine"/>
		<component api="TokenManager" class="io.vertigo.vega.impl.token.TokenManagerImpl">
			<param name="collection" value="mars-api" />
		</component>
	</module>
	<module name="vega-webservices"  >
		<component class="io.vertigo.vega.impl.webservice.catalog.CatalogWebServices" />
		<component class="io.vertigo.vega.impl.webservice.catalog.SwaggerWebServices" />
	</module>
	
	<module name="aop">
		<aspect class="io.vertigo.commons.impl.transaction.VTransactionAspect"/>
	</module>
	
	<module name="orchestra-dao" >
		<component class="io.vertigo.orchestra.dao.definition.OProcessDAO"/>
		<component class="io.vertigo.orchestra.dao.definition.OActivityDAO"/>
		<component class="io.vertigo.orchestra.dao.planification.OProcessPlanificationDAO"/>
		<component class="io.vertigo.orchestra.dao.execution.OActivityExecutionDAO"/>
		<component class="io.vertigo.orchestra.dao.execution.OProcessExecutionDAO"/>
		<component class="io.vertigo.orchestra.dao.execution.OActivityWorkspaceDAO"/>
		<component class="io.vertigo.orchestra.dao.execution.OActivityLogDAO"/>
		<component class="io.vertigo.orchestra.dao.execution.ExecutionPAO"/>
		<component class="io.vertigo.orchestra.dao.planification.PlanificationPAO"/>
		<component class="io.vertigo.orchestra.dao.execution.ONodeDAO"/>
		<component class="io.vertigo.orchestra.dao.definition.DefinitionPAO"/>
		<component class="io.vertigo.orchestra.monitoring.dao.summary.SummaryPAO"/>
		<component class="io.vertigo.orchestra.monitoring.dao.uiexecutions.UiexecutionsPAO"/>
		<component class="io.vertigo.orchestra.monitoring.dao.uidefinitions.UidefinitionsPAO"/>
	</module>
	<module name="orchestra">
		<definitions>
			<provider class="io.vertigo.dynamo.plugins.environment.DynamoDefinitionProvider" >
				<resource type ="kpr" path="io/vertigo/orchestra/execution.kpr"/>
			    <resource type="classes" path="io.vertigo.orchestra.domain.DtDefinitions" />  
		    </provider>
		</definitions>   
		<component api="ONodeManager" class="io.vertigo.orchestra.impl.node.ONodeManagerImpl"/>
		<component api="OrchestraDefinitionManager" class="io.vertigo.orchestra.impl.definitions.OrchestraDefinitionManagerImpl">
			<plugin class="io.vertigo.orchestra.plugins.definitions.db.DbProcessDefinitionStorePlugin"/>
		</component>
		<component api="OrchestraServices" class="io.vertigo.orchestra.impl.services.OrchestraServicesImpl">
			<plugin class="io.vertigo.orchestra.plugins.services.schedule.db.DbProcessSchedulerPlugin">
				<param name="nodeName" value="MARS1" />
				<param name="planningPeriodSeconds" value="30" />
				<param name="forecastDurationSeconds" value="60" />
			</plugin>
			<plugin class="io.vertigo.orchestra.plugins.services.execution.db.DbProcessExecutorPlugin">
				<param name="nodeName" value="MARS1" />
				<param name="executionPeriodSeconds" value="30" />
				<param name="workersCount" value="10" />
			</plugin>
			<plugin class="io.vertigo.orchestra.plugins.services.log.db.DbProcessLoggerPlugin"/>
			<plugin class="io.vertigo.orchestra.plugins.services.report.db.DbProcessReportPlugin"/>
		</component>
	</module>
	<module name="orchestra-webservices"  >
		<component class="io.vertigo.orchestra.webservices.WsInfos" />
		<component class="io.vertigo.orchestra.webservices.WsDefinition" />
		<component class="io.vertigo.orchestra.webservices.WsExecution" />
		<component class="io.vertigo.orchestra.webservices.WsExecutionControl" />
	</module>
	 
	<module name="mars-boot-resources">
		<definitions>
			<provider class="io.vertigo.dynamo.plugins.environment.DynamoDefinitionProvider" >
				<resource type="kpr" path="io/mars/run.kpr" />
				<resource type="classes" path="io.mars.domain.DtDefinitions" />
			</provider>
		</definitions>
	</module>

	<init>
		<!-- initializer class="io.mars.boot.DataBaseInitializer"/ --> 
		<initializer class="io.mars.boot.MasterDataInitializer"/>
		<initializer class="io.mars.boot.I18nResourcesInitializer"/>
		<initializer class="io.mars.boot.SearchInitializer"/>
	</init>
</config>
